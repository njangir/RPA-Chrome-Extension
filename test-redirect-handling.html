<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Redirect Handling Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .instructions {
            background-color: #e7f3ff;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        .redirect-button {
            background: #007bff;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        .redirect-button:hover {
            background: #0056b3;
        }
        .step-indicator {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            border-left: 4px solid #007bff;
        }
        .url-display {
            background: #e9ecef;
            padding: 8px;
            border-radius: 3px;
            font-family: monospace;
            font-size: 12px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <h1>Redirect Handling Test</h1>
    
    <div class="instructions">
        <h3>Test Instructions:</h3>
        <ol>
            <li>Start recording in your RPA extension</li>
            <li>Click the "Go to Page 2" button below</li>
            <li>Notice that the URL changes and steps are preserved</li>
            <li>Click "Go to Page 3" to test another redirect</li>
            <li>Stop recording and check the accordion - all steps should be there</li>
            <li>Test playback - it should navigate to the start URL first</li>
        </ol>
    </div>

    <div class="test-section">
        <h3>Page 1 - Start Page</h3>
        <div class="url-display" id="currentUrl">Current URL: <span id="urlSpan"></span></div>
        
        <div class="step-indicator">
            <strong>Step 1:</strong> Click the button below to test redirect handling
        </div>
        
        <button class="redirect-button" onclick="goToPage2()">
            Go to Page 2
        </button>
        
        <div class="step-indicator">
            <strong>Step 2:</strong> This is a regular input field
        </div>
        
        <input type="text" placeholder="Enter some text" id="input1" style="padding: 8px; width: 200px;">
    </div>

    <div class="test-section">
        <h3>Test Different Redirect Types</h3>
        <button class="redirect-button" onclick="goToPage3()">
            Go to Page 3 (Different redirect)
        </button>
        
        <button class="redirect-button" onclick="goToPage4()">
            Go to Page 4 (Hash change)
        </button>
        
        <button class="redirect-button" onclick="goToPage5()">
            Go to Page 5 (Query params)
        </button>
    </div>

    <div class="test-section">
        <h3>Current Page Actions</h3>
        <button class="redirect-button" onclick="addStep()">
            Add Test Step
        </button>
        
        <button class="redirect-button" onclick="showSteps()">
            Show Recorded Steps
        </button>
        
        <div id="stepsDisplay" style="margin-top: 10px; padding: 10px; background: #f8f9fa; border-radius: 5px; display: none;">
            <h4>Recorded Steps:</h4>
            <div id="stepsList"></div>
        </div>
    </div>

    <script>
        let stepCount = 0;
        const recordedSteps = [];

        // Update URL display
        function updateUrlDisplay() {
            document.getElementById('urlSpan').textContent = window.location.href;
        }

        // Initialize
        updateUrlDisplay();
        window.addEventListener('popstate', updateUrlDisplay);

        // Redirect functions
        function goToPage2() {
            window.location.href = 'test-redirect-handling.html?page=2';
        }

        function goToPage3() {
            window.location.href = 'test-redirect-handling.html?page=3&redirect=true';
        }

        function goToPage4() {
            window.location.href = 'test-redirect-handling.html?page=4#section1';
        }

        function goToPage5() {
            window.location.href = 'test-redirect-handling.html?page=5&param=value&test=redirect';
        }

        // Test functions
        function addStep() {
            stepCount++;
            const step = {
                id: stepCount,
                action: 'click',
                element: 'button',
                timestamp: new Date().toISOString(),
                url: window.location.href
            };
            recordedSteps.push(step);
            console.log('Added step:', step);
            alert(`Added step ${stepCount} on ${window.location.href}`);
        }

        function showSteps() {
            const display = document.getElementById('stepsDisplay');
            const list = document.getElementById('stepsList');
            
            if (recordedSteps.length === 0) {
                list.innerHTML = '<p>No steps recorded yet</p>';
            } else {
                list.innerHTML = recordedSteps.map(step => 
                    `<div style="margin: 5px 0; padding: 5px; background: white; border-radius: 3px;">
                        <strong>Step ${step.id}:</strong> ${step.action} on ${step.element} 
                        <br><small>URL: ${step.url}</small>
                        <br><small>Time: ${step.timestamp}</small>
                    </div>`
                ).join('');
            }
            
            display.style.display = display.style.display === 'none' ? 'block' : 'none';
        }

        // Page-specific content based on URL params
        function loadPageContent() {
            const urlParams = new URLSearchParams(window.location.search);
            const page = urlParams.get('page');
            
            if (page) {
                const title = document.querySelector('h1');
                title.textContent = `Redirect Handling Test - Page ${page}`;
                
                const content = document.querySelector('.test-section h3');
                content.textContent = `Page ${page} - Redirected Page`;
                
                // Add page-specific content
                const newContent = document.createElement('div');
                newContent.innerHTML = `
                    <div class="step-indicator">
                        <strong>This is Page ${page}</strong> - You were redirected here!
                    </div>
                    <p>URL Parameters: ${window.location.search}</p>
                    <p>Hash: ${window.location.hash || 'None'}</p>
                `;
                document.querySelector('.test-section').appendChild(newContent);
            }
        }

        // Initialize page content
        loadPageContent();
        updateUrlDisplay();

        // Log page changes for debugging
        console.log('Page loaded:', window.location.href);
        console.log('Search params:', window.location.search);
        console.log('Hash:', window.location.hash);
    </script>
</body>
</html>
